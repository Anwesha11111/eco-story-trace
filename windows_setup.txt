# Food_Found Backend Setup Script for Windows
# Run this in PowerShell

Write-Host "üöÄ Creating Food_Found Backend Structure..." -ForegroundColor Green

# Create directory structure
$dirs = @(
    "backend\src\config",
    "backend\src\models",
    "backend\src\controllers",
    "backend\src\routes",
    "backend\src\middleware",
    "backend\src\services",
    "backend\src\utils",
    "backend\src\scripts",
    "backend\contracts",
    "backend\tests\unit",
    "backend\tests\integration",
    "deployment\k8s",
    "deployment\.github\workflows"
)

foreach ($dir in $dirs) {
    New-Item -ItemType Directory -Force -Path $dir | Out-Null
}

Write-Host "‚úÖ Directory structure created" -ForegroundColor Green

# Navigate to backend
Set-Location backend

# Create package.json
@"
{
  "name": "food-found-backend",
  "version": "1.0.0",
  "description": "Backend for Food_Found - Food waste reduction platform",
  "main": "src/server.js",
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js",
    "test": "jest --coverage",
    "test:watch": "jest --watch",
    "migrate": "node src/scripts/migrate.js",
    "seed": "node src/scripts/seed.js",
    "deploy:contracts": "hardhat run scripts/deploy.js --network mumbai"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^8.0.0",
    "ethers": "^6.9.0",
    "jsonwebtoken": "^9.0.2",
    "bcryptjs": "^2.4.3",
    "dotenv": "^16.3.1",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "express-rate-limit": "^7.1.5",
    "socket.io": "^4.6.0",
    "joi": "^17.11.0",
    "multer": "^1.4.5-lts.1",
    "cloudinary": "^1.41.0",
    "nodemailer": "^6.9.7",
    "winston": "^3.11.0",
    "@sendgrid/mail": "^8.1.0",
    "geolib": "^3.3.4",
    "redis": "^4.6.11"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "jest": "^29.7.0",
    "supertest": "^6.3.3",
    "hardhat": "^2.19.2",
    "@nomicfoundation/hardhat-toolbox": "^4.0.0"
  }
}
"@ | Out-File -FilePath "package.json" -Encoding utf8

# Create .env.example
@"
# Server Configuration
NODE_ENV=development
PORT=5000
FRONTEND_URL=http://localhost:3000

# Database
MONGODB_URI=mongodb://localhost:27017/foodfound
REDIS_URL=redis://localhost:6379

# JWT Authentication
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d

# Blockchain - Polygon/Ethereum
BLOCKCHAIN_NETWORK=polygon-mumbai
INFURA_API_KEY=your-infura-api-key
ALCHEMY_API_KEY=your-alchemy-api-key
PRIVATE_KEY=your-wallet-private-key-for-contract-deployment
CONTRACT_ADDRESS=deployed-contract-address
POLYGONSCAN_API_KEY=your-polygonscan-api-key

# Cloud Storage - Cloudinary
CLOUDINARY_CLOUD_NAME=your-cloudinary-cloud-name
CLOUDINARY_API_KEY=your-cloudinary-api-key
CLOUDINARY_API_SECRET=your-cloudinary-api-secret

# Email Service - SendGrid
SENDGRID_API_KEY=your-sendgrid-api-key
FROM_EMAIL=noreply@foodfound.com

# Geocoding - Google Maps or Mapbox
GOOGLE_MAPS_API_KEY=your-google-maps-api-key
MAPBOX_ACCESS_TOKEN=your-mapbox-token

# SMS Notifications - Twilio (Optional)
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=your-twilio-phone-number

# Push Notifications - Firebase (Optional)
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_PRIVATE_KEY=your-firebase-private-key
FIREBASE_CLIENT_EMAIL=your-firebase-client-email

# Security
CORS_ORIGIN=http://localhost:3000,https://yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Logging
LOG_LEVEL=info
"@ | Out-File -FilePath ".env.example" -Encoding utf8

# Create .gitignore
@"
node_modules/
.env
.env.local
.DS_Store
*.log
coverage/
dist/
build/
.vscode/
.idea/
*.swp
*.swo
.cache/
artifacts/
cache/
"@ | Out-File -FilePath ".gitignore" -Encoding utf8

# Create README.md
@"
# Food_Found Backend

Complete backend for the Food_Found food waste reduction platform.

## Quick Start

```bash
# Install dependencies
npm install

# Copy environment variables
copy .env.example .env

# Edit .env with your credentials

# Run development server
npm run dev
```

## Documentation

See SETUP.md for complete setup instructions.

## API Endpoints

- POST /api/auth/register - Register new user
- POST /api/auth/login - Login user
- GET /api/food/nearby - Get nearby food listings
- POST /api/food - Create food listing
- POST /api/food/:id/claim - Claim a listing

## Tech Stack

- Node.js + Express
- MongoDB + Mongoose
- Socket.IO (real-time)
- Ethers.js (blockchain)
- JWT Authentication
"@ | Out-File -FilePath "README.md" -Encoding utf8

# Create Dockerfile
@"
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY src ./src

RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

RUN chown -R nodejs:nodejs /app

USER nodejs

EXPOSE 5000

CMD ["node", "src/server.js"]
"@ | Out-File -FilePath "Dockerfile" -Encoding utf8

# Create docker-compose.yml
@"
version: '3.8'

services:
  backend:
    build: .
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongo:27017/foodfound
      - REDIS_URL=redis://redis:6379
    depends_on:
      - mongo
      - redis
    restart: unless-stopped

  mongo:
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped

volumes:
  mongo-data:
  redis-data:
"@ | Out-File -FilePath "docker-compose.yml" -Encoding utf8

Write-Host ""
Write-Host "‚úÖ Backend configuration files created!" -ForegroundColor Green
Write-Host ""
Write-Host "üìÅ Next steps:" -ForegroundColor Yellow
Write-Host "1. Run: .\create-source-files.ps1" -ForegroundColor Cyan
Write-Host "2. Run: npm install" -ForegroundColor Cyan
Write-Host "3. Copy .env.example to .env and add your API keys" -ForegroundColor Cyan
Write-Host "4. Run: npm run dev" -ForegroundColor Cyan
Write-Host ""
